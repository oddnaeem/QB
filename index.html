<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡¶¨‡¶æ‡¶ó‡¶ß‡¶æ‡¶∞‡¶æ MCQ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Noto Sans Bengali", sans-serif;
      background: #e6ecf0;
      margin: 0;
      padding: 0;
    }
    header {
      background: #2c3e50;
      padding: 20px;
      color: white;
      text-align: center;
      font-size: 1.8em;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      padding: 20px 30px;
    }
    .start-section, .quiz-section {
      display: none;
    }
    .start-section.active, .quiz-section.active {
      display: block;
    }
    .form-group {
      margin-bottom: 20px;
      text-align: center;
    }
    label, input[type=number] {
      font-size: 1.1em;
    }
    input[type=number] {
      padding: 10px;
      width: 80px;
      border-radius: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }
    button {
      background-color: #3498db;
      color: white;
      padding: 12px 24px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    .question {
      margin-bottom: 20px;
    }
    .question-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .options label {
      display: block;
      background: #f2f2f2;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
      border: 1px solid #ccc;
    }
    .options label:hover {
      background: #e0e0e0;
    }
    .feedback {
      font-weight: bold;
      margin-top: 8px;
    }
    .correct { color: green; }
    .incorrect { color: red; }
    #timer {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: #e67e22;
      margin-bottom: 20px;
    }
    #result {
      text-align: center;
      font-size: 1.3em;
      margin-top: 30px;
      background: #ecf9ec;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #2ecc71;
    }
  </style>
</head>
<body>
  <header>
    üìù ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡¶æ‡¶ó‡¶ß‡¶æ‡¶∞‡¶æ MCQ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ
  </header>
  <div class="container">
    <section id="startSection" class="start-section active">
      <div class="form-group">
        <label>‚è±Ô∏è ‡¶∏‡¶Æ‡ßü (‡¶ò‡¶£‡ßç‡¶ü‡¶æ:‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü:‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°):</label><br>
        <input type="number" id="h" value="0" min="0"> :
        <input type="number" id="m" value="3" min="0" max="59"> :
        <input type="number" id="s" value="0" min="0" max="59">
      </div>
      <div class="form-group">
        <label>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ:</label><br>
        <input type="number" id="qCount" value="30" min="1" max="100">
      </div>
      <div class="form-group">
        <button onclick="startExam()">‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßã</button>
      </div>
    </section>

    <section id="quizSection" class="quiz-section">
      <div id="timer"></div>
      <form id="quizForm"></form>
      <button id="submitBtn" disabled onclick="submitExam()" type="button">‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶æ‡¶ì</button>
      <div id="result"></div>
    </section>
  </div>

<script>
  let allQuestions = [];
  let selectedQuestions = [];
  let attempted = 0;
  let score = 0;
  let timeLeft = 0;
  let timerInterval;
  const NEGATIVE_MARK = 0.5;

  async function loadQuestions() {
    try {
      const res = await fetch('Data.json');
      if (!res.ok) throw new Error('‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶°‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
      allQuestions = await res.json();
    } catch (e) {
      alert('‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + e.message);
      allQuestions = [];
    }
  }

  function shuffleArray(arr) {
    return arr.map(a => [Math.random(), a]).sort((a,b) => a[0] - b[0]).map(a => a[1]);
  }

  function formatTime(sec) {
    const h = Math.floor(sec / 3600);
    const m = Math.floor((sec % 3600) / 60);
    const s = sec % 60;
    return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  }

  function getUnusedIndexes(total, usedIndexes, maxIndex) {
    const allIndexes = Array.from({length: maxIndex}, (_, i) => i);
    const available = allIndexes.filter(i => !usedIndexes.includes(i));
    return shuffleArray(available).slice(0, total);
  }

  async function startExam() {
    await loadQuestions();
    if(allQuestions.length === 0){
      alert('‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
      return;
    }
    const h = parseInt(document.getElementById("h").value) || 0;
    const m = parseInt(document.getElementById("m").value) || 0;
    const s = parseInt(document.getElementById("s").value) || 0;
    timeLeft = h*3600 + m*60 + s;
    if(timeLeft < 10){
      alert('‡¶∏‡¶Æ‡ßü ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá 10 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§');
      return;
    }

    let total = parseInt(document.getElementById("qCount").value) || 30;
    if(total < 1) total = 1;
    if(total > allQuestions.length) total = allQuestions.length;

    const usedIndexes = JSON.parse(localStorage.getItem("usedIndexes") || "[]");
    let newIndexes = getUnusedIndexes(total, usedIndexes, allQuestions.length);

    if(newIndexes.length < total){
      localStorage.removeItem("usedIndexes");
      newIndexes = getUnusedIndexes(total, [], allQuestions.length);
    }

    selectedQuestions = newIndexes.map(i => allQuestions[i]);
    localStorage.setItem("usedIndexes", JSON.stringify([...usedIndexes, ...newIndexes]));

    attempted = 0;
    score = 0;

    document.getElementById("startSection").classList.remove("active");
    document.getElementById("quizSection").classList.add("active");
    document.getElementById("result").textContent = "";

    renderQuestions();
    startTimer();
  }

  function renderQuestions() {
    const form = document.getElementById("quizForm");
    form.innerHTML = "";

    selectedQuestions.forEach((q, i) => {
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `<div class='question-title'>${i+1}. ${q.question}</div>`;

      const optionsDiv = document.createElement("div");
      optionsDiv.className = "options";

      shuffleArray(q.options).forEach(opt => {
        const label = document.createElement("label");
        label.innerHTML = `<input type="radio" name="q${i}" value="${opt}"> ${opt}`;

        label.querySelector("input").addEventListener("change", () => {
          checkAllAnswered();
        });

        optionsDiv.appendChild(label);
      });

      div.appendChild(optionsDiv);
      form.appendChild(div);
    });

    checkAllAnswered();
  }

  function checkAllAnswered() {
    const total = selectedQuestions.length;
    let answered = 0;
    for(let i=0; i<total; i++){
      if(document.querySelector(`input[name='q${i}']:checked`)) answered++;
    }
    document.getElementById("submitBtn").disabled = answered !== total;
  }

  function submitExam() {
    clearInterval(timerInterval);
    evaluateExam();
  }

  function evaluateExam() {
    const form = document.getElementById("quizForm");
    const questions = form.querySelectorAll(".question");

    selectedQuestions.forEach((q, i) => {
      const inputs = document.querySelectorAll(`input[name='q${i}']`);
      let selected = null;
      inputs.forEach(input => {
        input.disabled = true;
        if (input.checked) selected = input.value;
        input.parentElement.style.backgroundColor = '';
        input.parentElement.style.color = '';
        input.parentElement.style.fontWeight = 'normal';
      });

      if (selected) {
        if (selected === q.answer) {
          score++;
          inputs.forEach(input => {
            if (input.value === q.answer) {
              input.parentElement.style.backgroundColor = '#d4edda';
              input.parentElement.style.color = '#155724';
              input.parentElement.style.fontWeight = 'bold';
            }
          });
        } else {
          score -= NEGATIVE_MARK;
          inputs.forEach(input => {
            if (input.checked) {
              input.parentElement.style.backgroundColor = '#f8d7da';
              input.parentElement.style.color = '#721c24';
              input.parentElement.style.fontWeight = 'bold';
            }
          });
        }
      } 
      // ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶π‡¶æ‡¶á‡¶≤‡¶æ‡¶á‡¶ü ‡¶®‡ßá‡¶á
    });

    document.getElementById("result").textContent = `üéØ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßã‡¶∞: ${score.toFixed(2)} / ${selectedQuestions.length}`;
    document.getElementById("submitBtn").disabled = true;
  }

  function startTimer() {
    const timerDisplay = document.getElementById("timer");
    timerDisplay.textContent = `‚è≥ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞: ${formatTime(timeLeft)}`;

    timerInterval = setInterval(() => {
      timeLeft--;
      timerDisplay.textContent = `‚è≥ ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞: ${formatTime(timeLeft)}`;
      if(timeLeft <= 0){
        clearInterval(timerInterval);
        alert("‡¶∏‡¶Æ‡ßü ‡¶∂‡ßá‡¶∑!");
        submitExam();
      }
    }, 1000);
  }
</script>

</body>
</html>
